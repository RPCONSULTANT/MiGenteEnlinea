@{
    ViewData["Title"] = "Colaboradores - Mi Gente en Linea";
    Layout = "_LayoutEmpleador";
}

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "Empleador")" class="text-primary">
                <i class="fas fa-home me-1"></i>Dashboard
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <i class="fas fa-users me-1"></i>Colaboradores
        </li>
    </ol>
</nav>

<div class="container-fluid bg-white pt-3 pb-4" style="border-radius: 10px; box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);">
    
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1" style="font-family: 'Open Sans', sans-serif; font-weight: 600;">
                <i class="fas fa-users text-primary me-2"></i>Gestión de Colaboradores
            </h2>
            <p class="text-muted mb-0">Registra y gestiona tu equipo de trabajo de forma centralizada</p>
        </div>
        <div class="d-flex gap-2">
            <a href="@Url.Action("Index", "Empleador")" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Volver
            </a>
        </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-uppercase font-weight-bold opacity-8">Total Activos</p>
                            <h3 class="font-weight-bolder mb-0" id="statActivos">0</h3>
                        </div>
                        <div class="icon icon-shape bg-white shadow text-center rounded-circle">
                            <i class="fas fa-user-check text-primary text-lg opacity-10"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-gradient-secondary text-white">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-uppercase font-weight-bold opacity-8">Inactivos</p>
                            <h3 class="font-weight-bolder mb-0" id="statInactivos">0</h3>
                        </div>
                        <div class="icon icon-shape bg-white shadow text-center rounded-circle">
                            <i class="fas fa-user-minus text-secondary text-lg opacity-10"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-gradient-success text-white">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-uppercase font-weight-bold opacity-8">Nómina Mensual</p>
                            <h3 class="font-weight-bolder mb-0" id="statNomina">RD$ 0</h3>
                        </div>
                        <div class="icon icon-shape bg-white shadow text-center rounded-circle">
                            <i class="fas fa-dollar-sign text-success text-lg opacity-10"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-gradient-info text-white cursor-pointer" onclick="window.location.href='@Url.Action("Nomina", "Empleador")'" style="cursor: pointer;">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between">
                        <div>
                            <p class="text-sm mb-0 text-uppercase font-weight-bold opacity-8">Gestionar</p>
                            <h5 class="font-weight-bolder mb-0">Nómina <i class="fas fa-arrow-right ms-1"></i></h5>
                        </div>
                        <div class="icon icon-shape bg-white shadow text-center rounded-circle">
                            <i class="fas fa-file-invoice-dollar text-info text-lg opacity-10"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-pills nav-fill mb-3 bg-light p-2 rounded" id="tabsEmpleados" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active d-flex align-items-center justify-content-center" id="empleadosActivos-tab" 
                    data-bs-toggle="tab" data-bs-target="#empleadosActivos" type="button" role="tab">
                <i class="fas fa-user-check me-2"></i>
                <span>Colaboradores Activos</span>
                <span class="badge bg-primary ms-2" id="badgeActivos">0</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link d-flex align-items-center justify-content-center" id="empleadosInactivos-tab" 
                    data-bs-toggle="tab" data-bs-target="#empleadosInactivos" type="button" role="tab">
                <i class="fas fa-user-minus me-2"></i>
                <span>Colaboradores Inactivos</span>
                <span class="badge bg-secondary ms-2" id="badgeInactivos">0</span>
            </button>
        </li>
    </ul>

    <div class="tab-content" id="tabContent">
        <!-- Tab Colaboradores Activos -->
        <div class="tab-pane fade show active" id="empleadosActivos" role="tabpanel" aria-labelledby="empleadosActivos-tab">
            
            <!-- Action Buttons -->
            <div class="d-flex flex-wrap gap-2 mb-3">
                <button class="btn btn-primary" id="btnNew" type="button" data-bs-toggle="modal" data-bs-target="#registroEmpleadoModal">
                    <i class="fas fa-plus me-1"></i>Registrar Nuevo Colaborador
                </button>
                <button class="btn btn-outline-info" id="btnNomina" type="button" onclick="window.location.href='@Url.Action("Nomina", "Empleador")'">
                    <i class="fas fa-file-invoice-dollar me-1"></i>Gestión de Nómina
                </button>
                <button class="btn btn-outline-success" id="btnExportar" type="button" onclick="exportarEmpleados()">
                    <i class="fas fa-file-excel me-1"></i>Exportar a Excel
                </button>
                <button class="btn btn-outline-secondary" type="button" onclick="loadEmpleados()">
                    <i class="fas fa-sync-alt me-1"></i>Actualizar
                </button>
            </div>

            <!-- Search Box -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" class="form-control" id="searchActivos" placeholder="Buscar por nombre o cédula...">
                    </div>
                </div>
            </div>

            <!-- Grid Empleados Activos -->
            <div class="card shadow-sm">
                <div class="card-header bg-light py-2">
                    <h6 class="mb-0"><i class="fas fa-list me-2"></i>Lista de Colaboradores Activos</h6>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" id="gridEmpleados">
                        <thead class="bg-light">
                            <tr>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Cédula</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Nombre</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Apellido</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Fecha Inicio</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-end">Salario</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-center">Periodo</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyActivos">
                            <tr>
                                <td colspan="7" class="text-center py-5">
                                    <i class="fas fa-spinner fa-spin fa-2x text-muted mb-3 d-block"></i>
                                    <span class="text-muted">Cargando colaboradores...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Colaboradores Inactivos -->
        <div class="tab-pane fade" id="empleadosInactivos" role="tabpanel" aria-labelledby="empleadosInactivos-tab">
            
            <!-- Action Buttons -->
            <div class="d-flex flex-wrap gap-2 mb-3">
                <button class="btn btn-outline-success" id="btnExportarInactivos" type="button">
                    <i class="fas fa-file-excel me-1"></i>Exportar a Excel
                </button>
                <button class="btn btn-outline-secondary" type="button" onclick="loadEmpleados()">
                    <i class="fas fa-sync-alt me-1"></i>Actualizar
                </button>
            </div>

            <!-- Search Box -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" class="form-control" id="searchInactivos" placeholder="Buscar por nombre o cédula...">
                    </div>
                </div>
            </div>

            <!-- Grid Empleados Inactivos -->
            <div class="card shadow-sm">
                <div class="card-header bg-light py-2">
                    <h6 class="mb-0"><i class="fas fa-list me-2"></i>Lista de Colaboradores Inactivos</h6>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" id="gridInactivos">
                        <thead class="bg-light">
                            <tr>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Cédula</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Nombre</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Apellido</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder">Fecha Inicio</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-end">Salario</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-center">Fecha Salida</th>
                                <th scope="col" class="text-uppercase text-xs font-weight-bolder text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyInactivos">
                            <tr>
                                <td colspan="7" class="text-center py-5">
                                    <i class="fas fa-user-minus fa-2x text-muted mb-3 d-block"></i>
                                    <span class="text-muted">No hay colaboradores inactivos</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Registro de Empleado -->
<div class="modal fade" id="registroEmpleadoModal" tabindex="-1" aria-labelledby="registroEmpleadoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title" id="registroEmpleadoModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Registro de Nuevo Colaborador
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Alert para mensajes -->
                <div id="empleadoAlert" class="alert d-none" role="alert"></div>
                
                <!-- Accordion para organizar secciones -->
                <div class="accordion" id="accordionEmpleado">
                    
                    <!-- Sección 1: Datos de Contratación -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContratacion" aria-expanded="true">
                                <i class="fas fa-briefcase me-2 text-primary"></i>Datos de Contratación
                            </button>
                        </h2>
                        <div id="collapseContratacion" class="accordion-collapse collapse show" data-bs-parent="#accordionEmpleado">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="fechaDeIngreso" class="form-label fw-bold">
                                            <i class="fas fa-calendar-alt me-1 text-muted"></i>Fecha de Inicio <span class="text-danger">*</span>
                                        </label>
                                        <input type="date" class="form-control" id="fechaDeIngreso" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="posicion" class="form-label fw-bold">
                                            <i class="fas fa-id-badge me-1 text-muted"></i>Posición que Ocupa <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="posicion" placeholder="Ej: Asistente, Supervisor, etc." required />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="salario" class="form-label fw-bold">
                                            <i class="fas fa-dollar-sign me-1 text-muted"></i>Salario Bruto Mensual <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text">RD$</span>
                                            <input type="text" class="form-control text-end" id="salario" value="0.00" 
                                                   placeholder="0.00" pattern="[0-9,.]+" required />
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="periodos" class="form-label fw-bold">
                                            <i class="fas fa-calendar-week me-1 text-muted"></i>Periodo de Pago
                                        </label>
                                        <select class="form-select" id="periodos">
                                            <option value="1">Semanal</option>
                                            <option value="2" selected>Quincenal</option>
                                            <option value="3">Mensual</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="chkDeducciones" checked />
                                            <label class="form-check-label" for="chkDeducciones">
                                                <i class="fas fa-file-invoice-dollar me-1 text-muted"></i>Aplica Deducciones TSS
                                            </label>
                                        </div>
                                        <small class="text-muted">Marque si el empleado cotiza en la Seguridad Social</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección 2: Información Personal -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePersonal" aria-expanded="false">
                                <i class="fas fa-user me-2 text-info"></i>Información Personal
                            </button>
                        </h2>
                        <div id="collapsePersonal" class="accordion-collapse collapse" data-bs-parent="#accordionEmpleado">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <label for="txtIdentificacion" class="form-label fw-bold">
                                            <i class="fas fa-id-card me-1 text-muted"></i>Cédula de Identidad <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="txtIdentificacion" 
                                                   placeholder="000-0000000-0" maxlength="13" required />
                                            <button class="btn btn-outline-primary" id="btnBuscarCedula" type="button">
                                                <i class="fas fa-search me-1"></i>Validar
                                            </button>
                                        </div>
                                        <small class="text-muted">Ingrese la cédula sin guiones (11 dígitos)</small>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="ddlEstadoCivil" class="form-label fw-bold">Estado Civil</label>
                                        <select class="form-select" id="ddlEstadoCivil">
                                            <option value="1">Soltero(a)</option>
                                            <option value="2">Casado(a)</option>
                                            <option value="3">Unión Libre</option>
                                            <option value="4">Divorciado(a)</option>
                                            <option value="5">Viudo(a)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="nombre" class="form-label fw-bold">Nombre(s) <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="nombre" placeholder="Nombres" required />
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="apellido" class="form-label fw-bold">Apellido(s) <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="apellido" placeholder="Apellidos" required />
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="alias" class="form-label fw-bold">Alias / Apodo</label>
                                        <input type="text" class="form-control" id="alias" placeholder="Opcional" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="nacimiento" class="form-label fw-bold">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" id="nacimiento" />
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="telefono1" class="form-label fw-bold">
                                            <i class="fas fa-phone me-1 text-muted"></i>Teléfono Principal
                                        </label>
                                        <input type="tel" class="form-control" id="telefono1" 
                                               placeholder="809-000-0000" maxlength="12" />
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="telefono2" class="form-label fw-bold">
                                            <i class="fas fa-mobile-alt me-1 text-muted"></i>Teléfono Secundario
                                        </label>
                                        <input type="tel" class="form-control" id="telefono2" 
                                               placeholder="809-000-0000" maxlength="12" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección 3: Dirección -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDireccion" aria-expanded="false">
                                <i class="fas fa-map-marker-alt me-2 text-success"></i>Dirección
                            </button>
                        </h2>
                        <div id="collapseDireccion" class="accordion-collapse collapse" data-bs-parent="#accordionEmpleado">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="provincia" class="form-label fw-bold">Provincia</label>
                                        <select class="form-select" id="provincia">
                                            <option value="">Seleccione...</option>
                                            <option value="Distrito Nacional">Distrito Nacional</option>
                                            <option value="Santo Domingo">Santo Domingo</option>
                                            <option value="Santiago">Santiago</option>
                                            <option value="La Vega">La Vega</option>
                                            <option value="San Cristóbal">San Cristóbal</option>
                                            <option value="Puerto Plata">Puerto Plata</option>
                                            <option value="Duarte">Duarte</option>
                                            <option value="La Romana">La Romana</option>
                                            <option value="San Pedro de Macorís">San Pedro de Macorís</option>
                                            <option value="Otra">Otra</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="municipio" class="form-label fw-bold">Municipio / Sector</label>
                                        <input type="text" class="form-control" id="municipio" placeholder="Municipio o sector" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="direccion" class="form-label fw-bold">Dirección Completa</label>
                                        <textarea class="form-control" id="direccion" rows="2" maxlength="250" 
                                                  placeholder="Calle, número, edificio, apartamento, etc."></textarea>
                                        <small class="text-muted"><span id="direccionCount">0</span>/250 caracteres</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección 4: Otras Remuneraciones -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRemuneraciones" aria-expanded="false">
                                <i class="fas fa-hand-holding-usd me-2 text-warning"></i>Otras Remuneraciones (Opcional)
                            </button>
                        </h2>
                        <div id="collapseRemuneraciones" class="accordion-collapse collapse" data-bs-parent="#accordionEmpleado">
                            <div class="accordion-body">
                                <p class="text-muted mb-3">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Agregue bonificaciones, comisiones u otros pagos adicionales al salario base.
                                </p>
                                <div id="remuneracionesContainer">
                                    <div class="row remuneracion-row mb-2">
                                        <div class="col-md-7">
                                            <input type="text" class="form-control remuneracion-descripcion" 
                                                   placeholder="Descripción (ej: Bono transporte)" />
                                        </div>
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text">RD$</span>
                                                <input type="text" class="form-control text-end remuneracion-monto" 
                                                       placeholder="0.00" />
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                            <button type="button" class="btn btn-outline-danger btn-sm remove-remuneracion" disabled>
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="btnAddRemuneracion">
                                    <i class="fas fa-plus me-1"></i>Agregar otra remuneración
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección 5: Contacto de Emergencia -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmergencia" aria-expanded="false">
                                <i class="fas fa-first-aid me-2 text-danger"></i>Contacto de Emergencia
                            </button>
                        </h2>
                        <div id="collapseEmergencia" class="accordion-collapse collapse" data-bs-parent="#accordionEmpleado">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="nombreContacto" class="form-label fw-bold">Nombre del Contacto</label>
                                        <input type="text" class="form-control" id="nombreContacto" 
                                               placeholder="Nombre completo" />
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="telefonoContacto" class="form-label fw-bold">Teléfono del Contacto</label>
                                        <input type="tel" class="form-control" id="telefonoContacto" 
                                               placeholder="809-000-0000" maxlength="12" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            <div class="modal-footer bg-light">
                <div class="d-flex justify-content-between w-100">
                    <small class="text-muted align-self-center">
                        <span class="text-danger">*</span> Campos requeridos
                    </small>
                    <div>
                        <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button class="btn btn-success" id="btnCrear" type="button">
                            <i class="fas fa-save me-1"></i>Guardar Colaborador
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Tipo de Gestión -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title" id="exampleModalLabel">Tipo de Gestion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <a href="@Url.Action("Empleados", "Empleador")" class="btn btn-primary btn-lg mb-3">Colaboradores Fijos</a>
                <a href="@Url.Action("ContratacionesTemporales", "Empleador")" class="btn btn-secondary btn-lg">Contrataciones Temporales</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const API_BASE_URL = 'http://localhost:5015/api';
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function getAuthToken() {
            return localStorage.getItem('accessToken');
        }
        
        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.classList.remove('d-none');
        }
        
        function hideAlert(elementId) {
            const alert = document.getElementById(elementId);
            alert.classList.add('d-none');
        }
        
        function formatCurrency(value) {
            const num = parseFloat(value.replace(/[^0-9.]/g, '')) || 0;
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function parseCurrency(value) {
            return parseFloat(value.replace(/[^0-9.]/g, '')) || 0;
        }
        
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 3 && value.length < 6) {
                value = value.slice(0,3) + '-' + value.slice(3);
            } else if (value.length >= 6) {
                value = value.slice(0,3) + '-' + value.slice(3,6) + '-' + value.slice(6,10);
            }
            input.value = value;
        }
        
        function formatCedula(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 3 && value.length < 10) {
                value = value.slice(0,3) + '-' + value.slice(3);
            } else if (value.length >= 10) {
                value = value.slice(0,3) + '-' + value.slice(3,10) + '-' + value.slice(10,11);
            }
            input.value = value;
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Format currency inputs
            document.getElementById('salario').addEventListener('blur', function() {
                this.value = formatCurrency(this.value);
            });
            
            // Format phone inputs
            ['telefono1', 'telefono2', 'telefonoContacto'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', function() { formatPhone(this); });
            });
            
            // Format cedula input
            document.getElementById('txtIdentificacion').addEventListener('input', function() {
                formatCedula(this);
            });
            
            // Character counter for direccion
            document.getElementById('direccion').addEventListener('input', function() {
                document.getElementById('direccionCount').textContent = this.value.length;
            });
            
            // Load empleados on page load
            loadEmpleados();
        });
        
        // ============================================
        // REMUNERACIONES DINÁMICAS
        // ============================================
        document.getElementById('btnAddRemuneracion').addEventListener('click', function() {
            const container = document.getElementById('remuneracionesContainer');
            const newRow = document.createElement('div');
            newRow.className = 'row remuneracion-row mb-2';
            newRow.innerHTML = `
                <div class="col-md-7">
                    <input type="text" class="form-control remuneracion-descripcion" 
                           placeholder="Descripción (ej: Bono transporte)" />
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text">RD$</span>
                        <input type="text" class="form-control text-end remuneracion-monto" 
                               placeholder="0.00" />
                    </div>
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-outline-danger btn-sm remove-remuneracion">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            container.appendChild(newRow);
            
            // Add event listener for remove button
            newRow.querySelector('.remove-remuneracion').addEventListener('click', function() {
                newRow.remove();
            });
            
            // Add currency formatting
            newRow.querySelector('.remuneracion-monto').addEventListener('blur', function() {
                this.value = formatCurrency(this.value);
            });
        });
        
        // ============================================
        // VALIDAR CÉDULA
        // ============================================
        document.getElementById('btnBuscarCedula').addEventListener('click', async function() {
            const cedulaInput = document.getElementById('txtIdentificacion');
            const cedula = cedulaInput.value.replace(/\D/g, '');
            
            if (cedula.length !== 11) {
                Swal.fire({
                    title: 'Cédula Inválida',
                    text: 'La cédula debe tener 11 dígitos',
                    icon: 'warning',
                    confirmButtonColor: '#3085d6'
                });
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Validando...';
            
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/empleados/consultar-padron/${cedula}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // Auto-fill fields if API returns data
                    if (data.nombre) document.getElementById('nombre').value = data.nombre;
                    if (data.apellido) document.getElementById('apellido').value = data.apellido;
                    if (data.fechaNacimiento) document.getElementById('nacimiento').value = data.fechaNacimiento.split('T')[0];
                    
                    Swal.fire({
                        title: 'Cédula Válida',
                        text: 'Los datos han sido cargados automáticamente',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else if (response.status === 404) {
                    Swal.fire({
                        title: 'Cédula No Encontrada',
                        text: 'La cédula no fue encontrada en el padrón. Puede continuar ingresando los datos manualmente.',
                        icon: 'info'
                    });
                } else {
                    throw new Error('Error al validar cédula');
                }
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    title: 'Error de Conexión',
                    text: 'No se pudo validar la cédula. Puede continuar ingresando los datos manualmente.',
                    icon: 'warning'
                });
            } finally {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-search me-1"></i>Validar';
            }
        });
        
        // ============================================
        // GUARDAR EMPLEADO
        // ============================================
        document.getElementById('btnCrear').addEventListener('click', async function() {
            hideAlert('empleadoAlert');
            
            // Validar campos requeridos
            const cedula = document.getElementById('txtIdentificacion').value.replace(/\D/g, '');
            const nombre = document.getElementById('nombre').value.trim();
            const apellido = document.getElementById('apellido').value.trim();
            const posicion = document.getElementById('posicion').value.trim();
            const salario = parseCurrency(document.getElementById('salario').value);
            const fechaIngreso = document.getElementById('fechaDeIngreso').value;
            
            if (!cedula || cedula.length !== 11) {
                showAlert('empleadoAlert', 'La cédula debe tener 11 dígitos', 'danger');
                document.getElementById('collapsePersonal').classList.add('show');
                return;
            }
            
            if (!nombre || !apellido) {
                showAlert('empleadoAlert', 'El nombre y apellido son requeridos', 'danger');
                document.getElementById('collapsePersonal').classList.add('show');
                return;
            }
            
            if (!posicion) {
                showAlert('empleadoAlert', 'La posición es requerida', 'danger');
                document.getElementById('collapseContratacion').classList.add('show');
                return;
            }
            
            if (salario <= 0) {
                showAlert('empleadoAlert', 'El salario debe ser mayor a cero', 'danger');
                document.getElementById('collapseContratacion').classList.add('show');
                return;
            }
            
            // Recopilar remuneraciones
            const remuneraciones = [];
            document.querySelectorAll('.remuneracion-row').forEach(row => {
                const desc = row.querySelector('.remuneracion-descripcion')?.value?.trim();
                const monto = parseCurrency(row.querySelector('.remuneracion-monto')?.value || '0');
                if (desc && monto > 0) {
                    remuneraciones.push({ descripcion: desc, monto: monto });
                }
            });
            
            // Construir objeto empleado - nombres deben coincidir con CreateEmpleadoCommand
            const empleado = {
                identificacion: cedula,  // Backend espera 'identificacion', no 'cedula'
                nombre: nombre,
                apellido: apellido,
                alias: document.getElementById('alias').value.trim() || null,
                estadoCivil: parseInt(document.getElementById('ddlEstadoCivil').value),
                nacimiento: document.getElementById('nacimiento').value || null,  // Backend: 'nacimiento'
                direccion: document.getElementById('direccion').value.trim() || null,
                provincia: document.getElementById('provincia').value || null,
                municipio: document.getElementById('municipio').value.trim() || null,
                telefono1: document.getElementById('telefono1').value.replace(/\D/g, '') || null,
                telefono2: document.getElementById('telefono2').value.replace(/\D/g, '') || null,
                posicion: posicion,
                salario: salario,  // Backend: 'salario', no 'salarioBruto'
                periodoPago: parseInt(document.getElementById('periodos').value),
                tss: document.getElementById('chkDeducciones').checked,  // Backend: 'tss', no 'aplicaTss'
                fechaInicio: fechaIngreso,  // Backend: 'fechaInicio', no 'fechaIngreso'
                contactoEmergencia: document.getElementById('nombreContacto').value.trim() || null,  // Backend: 'contactoEmergencia'
                telefonoEmergencia: document.getElementById('telefonoContacto').value.replace(/\D/g, '') || null  // Backend: 'telefonoEmergencia'
                // Nota: remuneraciones se manejan por separado después de crear el empleado
            };
            
            // Mostrar loading
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Guardando...';
            
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/empleados`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(empleado)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    Swal.fire({
                        title: '¡Éxito!',
                        text: 'El colaborador ha sido registrado correctamente',
                        icon: 'success',
                        confirmButtonColor: '#28a745'
                    }).then(() => {
                        // Cerrar modal y recargar lista
                        const modal = bootstrap.Modal.getInstance(document.getElementById('registroEmpleadoModal'));
                        modal.hide();
                        loadEmpleados();
                        resetForm();
                    });
                } else {
                    const errorMsg = data.message || data.title || 'Error al guardar el colaborador';
                    showAlert('empleadoAlert', errorMsg, 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('empleadoAlert', 'Error de conexión. Verifique que el servidor esté disponible.', 'danger');
            } finally {
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-save me-1"></i>Guardar Colaborador';
            }
        });
        
        // ============================================
        // RESET FORM
        // ============================================
        function resetForm() {
            document.getElementById('txtIdentificacion').value = '';
            document.getElementById('nombre').value = '';
            document.getElementById('apellido').value = '';
            document.getElementById('alias').value = '';
            document.getElementById('nacimiento').value = '';
            document.getElementById('direccion').value = '';
            document.getElementById('provincia').value = '';
            document.getElementById('municipio').value = '';
            document.getElementById('telefono1').value = '';
            document.getElementById('telefono2').value = '';
            document.getElementById('posicion').value = '';
            document.getElementById('salario').value = '0.00';
            document.getElementById('nombreContacto').value = '';
            document.getElementById('telefonoContacto').value = '';
            document.getElementById('fechaDeIngreso').value = new Date().toISOString().split('T')[0];
            document.getElementById('ddlEstadoCivil').value = '1';
            document.getElementById('periodos').value = '2';
            document.getElementById('chkDeducciones').checked = true;
            document.getElementById('direccionCount').textContent = '0';
            
            // Reset remuneraciones - keep only first row
            const container = document.getElementById('remuneracionesContainer');
            const rows = container.querySelectorAll('.remuneracion-row');
            rows.forEach((row, index) => {
                if (index === 0) {
                    row.querySelector('.remuneracion-descripcion').value = '';
                    row.querySelector('.remuneracion-monto').value = '';
                } else {
                    row.remove();
                }
            });
            
            hideAlert('empleadoAlert');
        }
        
        // ============================================
        // CARGAR EMPLEADOS
        // ============================================
        // Variables globales para la búsqueda
        let allEmpleadosActivos = [];
        let allEmpleadosInactivos = [];
        
        async function loadEmpleados() {
            const token = getAuthToken();
            if (!token) {
                console.log('No auth token found');
                document.getElementById('tbodyActivos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3 d-block"></i>
                            <span class="text-muted">Sesión expirada. <a href="@Url.Action("Login", "Auth")">Iniciar sesión</a></span>
                        </td>
                    </tr>
                `;
                return;
            }
            
            try {
                // Load active employees (usando soloActivos como parámetro correcto)
                const response = await fetch(`${API_BASE_URL}/empleados?soloActivos=true&pageSize=100`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // API devuelve PaginatedList, extraer .items
                    allEmpleadosActivos = data.items || data;
                    console.log('Empleados activos cargados:', allEmpleadosActivos.length);
                    renderEmpleadosTable(allEmpleadosActivos, 'tbodyActivos', true);
                } else if (response.status === 401) {
                    document.getElementById('tbodyActivos').innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center py-5">
                                <i class="fas fa-lock fa-2x text-danger mb-3 d-block"></i>
                                <span class="text-muted">Sesión expirada. <a href="@Url.Action("Login", "Auth")">Iniciar sesión</a></span>
                            </td>
                        </tr>
                    `;
                    return;
                } else {
                    console.error('Error response:', response.status, await response.text());
                }
                
                // Load inactive employees
                const responseInactive = await fetch(`${API_BASE_URL}/empleados?soloActivos=false&pageSize=100`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (responseInactive.ok) {
                    const dataInactive = await responseInactive.json();
                    // API devuelve PaginatedList, extraer .items
                    allEmpleadosInactivos = dataInactive.items || dataInactive;
                    console.log('Empleados inactivos cargados:', allEmpleadosInactivos.length);
                    renderEmpleadosTable(allEmpleadosInactivos, 'tbodyInactivos', false);
                }
            } catch (error) {
                console.error('Error loading empleados:', error);
                document.getElementById('tbodyActivos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-exclamation-circle fa-2x text-danger mb-3 d-block"></i>
                            <span class="text-muted">Error de conexión. <button class="btn btn-link p-0" onclick="loadEmpleados()">Reintentar</button></span>
                        </td>
                    </tr>
                `;
            }
        }
        
        function renderEmpleadosTable(empleados, tableId, isActive = true) {
            const tbody = document.getElementById(isActive ? 'tbodyActivos' : 'tbodyInactivos');
            
            // Update stats
            if (isActive) {
                document.getElementById('statActivos').textContent = empleados?.length || 0;
                document.getElementById('badgeActivos').textContent = empleados?.length || 0;
                
                // Calculate total monthly payroll
                const totalNomina = (empleados || []).reduce((sum, e) => {
                    const salario = e.salario || 0;
                    // Normalize to monthly: semanal * 4, quincenal * 2
                    const factor = e.periodoPago === 1 ? 4 : (e.periodoPago === 2 ? 2 : 1);
                    return sum + (salario * factor);
                }, 0);
                document.getElementById('statNomina').textContent = 'RD$ ' + totalNomina.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
            } else {
                document.getElementById('statInactivos').textContent = empleados?.length || 0;
                document.getElementById('badgeInactivos').textContent = empleados?.length || 0;
            }
            
            if (!empleados || empleados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-${isActive ? 'users' : 'user-minus'} fa-2x text-muted mb-3 d-block"></i>
                            <span class="text-muted">${isActive ? 'No hay colaboradores activos registrados' : 'No hay colaboradores inactivos'}</span>
                            ${isActive ? '<br><small class="text-primary">Haz clic en "Registrar Nuevo Colaborador" para comenzar</small>' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Render table rows
            tbody.innerHTML = empleados.map(emp => `
                <tr data-id="${emp.empleadoId}">
                    <td>
                        <span class="text-sm font-weight-bold">${formatCedula(emp.identificacion) || '-'}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-sm bg-gradient-primary rounded-circle me-2">
                                <span class="text-white text-xs">${(emp.nombre || 'X')[0]}${(emp.apellido || 'X')[0]}</span>
                            </div>
                            <span>${emp.nombre || '-'}</span>
                        </div>
                    </td>
                    <td>${emp.apellido || '-'}</td>
                    <td>
                        <span class="text-sm">${emp.fechaInicio ? new Date(emp.fechaInicio).toLocaleDateString('es-DO') : '-'}</span>
                    </td>
                    <td class="text-end">
                        <span class="text-sm font-weight-bold text-success">RD$ ${(emp.salario || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                    </td>
                    <td class="text-center">
                        <span class="badge bg-gradient-${emp.periodoPago === 1 ? 'info' : (emp.periodoPago === 2 ? 'primary' : 'success')}">${emp.periodoPagoDescripcion || getPeriodoPagoText(emp.periodoPago)}</span>
                    </td>
                    <td class="text-center">
                        <div class="btn-group" role="group">
                            <a href="@Url.Action("FichaEmpleado", "Empleador")?id=${emp.empleadoId}" 
                               class="btn btn-sm btn-outline-primary" title="Ver ficha completa">
                                <i class="fas fa-eye"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline-info" 
                                    onclick="editEmpleado(${emp.empleadoId})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${isActive ? `
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="deleteEmpleado(${emp.empleadoId}, '${emp.nombre} ${emp.apellido}')" title="Dar de baja">
                                <i class="fas fa-user-minus"></i>
                            </button>
                            ` : `
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="reactivarEmpleado(${emp.empleadoId}, '${emp.nombre} ${emp.apellido}')" title="Reactivar">
                                <i class="fas fa-user-check"></i>
                            </button>
                            `}
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function formatCedula(cedula) {
            if (!cedula || cedula.length !== 11) return cedula;
            return `${cedula.substr(0, 3)}-${cedula.substr(3, 7)}-${cedula.substr(10, 1)}`;
        }
        
        // ============================================
        // ELIMINAR EMPLEADO (DAR DE BAJA)
        // ============================================
        async function deleteEmpleado(id, nombre) {
            const result = await Swal.fire({
                title: '¿Dar de baja a este colaborador?',
                html: `
                    <p>Estás a punto de dar de baja a: <strong>${nombre}</strong></p>
                    <div class="mt-3">
                        <label class="form-label">Fecha de salida:</label>
                        <input type="date" id="swal-fecha-salida" class="form-control" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="fas fa-user-minus me-1"></i>Sí, dar de baja',
                cancelButtonText: 'Cancelar',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                const fechaSalida = document.getElementById('swal-fecha-salida').value;
                
                try {
                    const token = getAuthToken();
                    const response = await fetch(`${API_BASE_URL}/empleados/${id}/dar-de-baja`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ fechaSalida: fechaSalida })
                    });
                    
                    if (response.ok) {
                        Swal.fire({
                            title: '¡Completado!',
                            text: 'El colaborador ha sido dado de baja correctamente.',
                            icon: 'success',
                            confirmButtonColor: '#28a745'
                        });
                        loadEmpleados();
                    } else {
                        const data = await response.json();
                        Swal.fire({
                            title: 'Error',
                            text: data.message || 'No se pudo completar la operación',
                            icon: 'error'
                        });
                    }
                } catch (error) {
                    console.error('Error:', error);
                    Swal.fire({
                        title: 'Error de Conexión',
                        text: 'No se pudo conectar con el servidor',
                        icon: 'error'
                    });
                }
            }
        }
        
        // ============================================
        // REACTIVAR EMPLEADO
        // ============================================
        async function reactivarEmpleado(id, nombre) {
            const result = await Swal.fire({
                title: '¿Reactivar a este colaborador?',
                html: `<p>Estás a punto de reactivar a: <strong>${nombre}</strong></p>`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="fas fa-user-check me-1"></i>Sí, reactivar',
                cancelButtonText: 'Cancelar',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                try {
                    const token = getAuthToken();
                    const response = await fetch(`${API_BASE_URL}/empleados/${id}/reactivar`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        Swal.fire({
                            title: '¡Completado!',
                            text: 'El colaborador ha sido reactivado correctamente.',
                            icon: 'success',
                            confirmButtonColor: '#28a745'
                        });
                        loadEmpleados();
                    } else {
                        const data = await response.json();
                        Swal.fire({
                            title: 'Error',
                            text: data.message || 'No se pudo completar la operación',
                            icon: 'error'
                        });
                    }
                } catch (error) {
                    console.error('Error:', error);
                    Swal.fire({
                        title: 'Error de Conexión',
                        text: 'No se pudo conectar con el servidor',
                        icon: 'error'
                    });
                }
            }
        }
        
        // ============================================
        // EDITAR EMPLEADO
        // ============================================
        function editEmpleado(id) {
            window.location.href = `@Url.Action("FichaEmpleado", "Empleador")?id=${id}&edit=true`;
        }
        
        // ============================================
        // EXPORTAR A EXCEL
        // ============================================
        function exportarEmpleados() {
            Swal.fire({
                title: 'Exportar Colaboradores',
                text: 'Esta función estará disponible próximamente.',
                icon: 'info',
                confirmButtonText: 'Entendido'
            });
        }
        
        function getPeriodoPagoText(periodo) {
            switch(parseInt(periodo)) {
                case 1: return 'Semanal';
                case 2: return 'Quincenal';
                case 3: return 'Mensual';
                default: return '-';
            }
        }
        
        // ============================================
        // BÚSQUEDA EN TIEMPO REAL
        // ============================================
        document.getElementById('searchActivos').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase().trim();
            filterTable(allEmpleadosActivos, term, true);
        });
        
        document.getElementById('searchInactivos').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase().trim();
            filterTable(allEmpleadosInactivos, term, false);
        });
        
        function filterTable(empleados, term, isActive) {
            if (!term) {
                // Si no hay término de búsqueda, mostrar todos
                renderEmpleadosTable(empleados, isActive ? 'tbodyActivos' : 'tbodyInactivos', isActive);
                return;
            }
            
            const filtered = empleados.filter(emp => {
                const cedula = (emp.identificacion || '').toLowerCase();
                const nombre = (emp.nombre || '').toLowerCase();
                const apellido = (emp.apellido || '').toLowerCase();
                const posicion = (emp.posicion || emp.cargo || '').toLowerCase();
                const nombreCompleto = `${nombre} ${apellido}`;
                return cedula.includes(term) || nombre.includes(term) || 
                       apellido.includes(term) || posicion.includes(term) ||
                       nombreCompleto.includes(term);
            });
            
            // Renderizar solo la tabla filtrada sin actualizar stats globales
            renderFilteredTable(filtered, isActive);
        }
        
        function renderFilteredTable(empleados, isActive) {
            const tbody = document.getElementById(isActive ? 'tbodyActivos' : 'tbodyInactivos');
            
            if (!empleados || empleados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5">
                            <i class="fas fa-search fa-2x text-muted mb-3 d-block"></i>
                            <span class="text-muted">No se encontraron resultados</span>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Render table rows (same as renderEmpleadosTable but without updating stats)
            tbody.innerHTML = empleados.map(emp => `
                <tr data-id="${emp.empleadoId}">
                    <td>
                        <span class="text-sm font-weight-bold">${formatCedula(emp.identificacion) || '-'}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-sm bg-gradient-primary rounded-circle me-2">
                                <span class="text-white text-xs">${(emp.nombre || 'X')[0]}${(emp.apellido || 'X')[0]}</span>
                            </div>
                            <span>${emp.nombre || '-'}</span>
                        </div>
                    </td>
                    <td>${emp.apellido || '-'}</td>
                    <td>
                        <span class="text-sm">${emp.fechaInicio ? new Date(emp.fechaInicio).toLocaleDateString('es-DO') : '-'}</span>
                    </td>
                    <td class="text-end">
                        <span class="text-sm font-weight-bold text-success">RD$ ${(emp.salario || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                    </td>
                    <td class="text-center">
                        <span class="badge bg-gradient-${emp.periodoPago === 1 ? 'info' : (emp.periodoPago === 2 ? 'primary' : 'success')}">${emp.periodoPagoDescripcion || getPeriodoPagoText(emp.periodoPago)}</span>
                    </td>
                    <td class="text-center">
                        <div class="btn-group" role="group">
                            <a href="@Url.Action("FichaEmpleado", "Empleador")?id=${emp.empleadoId}" 
                               class="btn btn-sm btn-outline-primary" title="Ver ficha completa">
                                <i class="fas fa-eye"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline-info" 
                                    onclick="editEmpleado(${emp.empleadoId})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${isActive ? `
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="deleteEmpleado(${emp.empleadoId}, '${emp.nombre} ${emp.apellido}')" title="Dar de baja">
                                <i class="fas fa-user-minus"></i>
                            </button>
                            ` : `
                            <button type="button" class="btn btn-sm btn-outline-success" 
                                    onclick="reactivarEmpleado(${emp.empleadoId}, '${emp.nombre} ${emp.apellido}')" title="Reactivar">
                                <i class="fas fa-user-check"></i>
                            </button>
                            `}
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Reset form when modal is closed
        document.getElementById('registroEmpleadoModal').addEventListener('hidden.bs.modal', function () {
            resetForm();
        });
    </script>
}
