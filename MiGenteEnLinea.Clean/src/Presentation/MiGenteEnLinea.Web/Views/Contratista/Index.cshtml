@model dynamic
@{
    Layout = "~/Views/Shared/_LayoutContratista.cshtml";
    ViewData["Title"] = "Perfil Profesional";
}

<style>
    .avatar {
        border-radius: 50%;
        width: 150px;
        height: 150px;
        object-fit: cover;
    }
</style>

<div class="container">
    <h3 class="text-white">Administrar Perfil Profesional</h3>

    <div class="row">
        <!-- Columna Izquierda - Foto de Perfil -->
        <div class="col-md-3" style="height: auto">
            <div class="card" style="text-align: center;">
                <div class="align-content-center justify-content-center" style="text-align: center; margin-top: 20px;">
                    <img src="https://via.placeholder.com/150" class="card-img-top avatar" id="profileImage" alt="Imagen de perfil">
                </div>
                <div class="card-body">
                    <h5 class="card-title">Imagen de Perfil</h5>
                    <input type="file" class="form-control" id="fileUpload" accept="image/*" />
                    <div class="mb-3" style="display: flex; flex-direction: column; align-items: center; text-align: center; margin-top: 15px;">
                        <label class="form-label">Calificación de Perfil</label>
                        <div id="ratingPerfil">
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star-o text-warning"></i>
                            <i class="fa fa-star-o text-warning"></i>
                        </div>
                        <span id="ratingValue">3.0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Columna Derecha - Datos del Perfil -->
        <div class="col-md-9 bg-white" style="height: auto; border-radius: 10px;">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#datosGenerales">Datos Generales</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#servicios">Catálogo de Servicios</a>
                </li>
            </ul>

            <div class="tab-content p-3">
                <!-- Tab Datos Generales -->
                <div class="tab-pane fade show active" id="datosGenerales">
                    <form id="formPerfil">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="txtTitulo" class="form-label">Título de Perfil</label>
                                            <input type="text" class="form-control" id="txtTitulo" name="Titulo" placeholder="Ej: Plomero Profesional" />
                                        </div>

                                        <div class="mb-3">
                                            <label for="ddlSector" class="form-label">Sector Profesional</label>
                                            <select class="form-control" id="ddlSector" name="Sector">
                                                <option value="">-- Seleccione --</option>
                                                <option value="Plomeria">Plomería</option>
                                                <option value="Electricidad">Electricidad</option>
                                                <option value="Carpinteria">Carpintería</option>
                                                <option value="Pintura">Pintura</option>
                                                <option value="Jardineria">Jardinería</option>
                                                <option value="Limpieza">Limpieza</option>
                                                <option value="Tecnologia">Tecnología</option>
                                                <option value="Otros">Otros</option>
                                            </select>
                                        </div>

                                        <div class="mb-3">
                                            <label for="presentacion" class="form-label">Presentación</label>
                                            <textarea class="form-control" id="presentacion" name="Presentacion" rows="4" placeholder="Agregue una breve presentación para que sus posibles clientes le conozcan mejor."></textarea>
                                        </div>

                                        <div class="mb-3">
                                            <label for="txtEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="txtEmail" name="Email" />
                                        </div>

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="txtExperiencia" class="form-label">Años de Experiencia</label>
                                                    <input type="number" class="form-control" id="txtExperiencia" name="AnosExperiencia" min="0" style="width: 80px;" />
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="mb-3">
                                                    <label for="comboProvincias" class="form-label">Provincia</label>
                                                    <select class="form-control" id="comboProvincias" name="Provincia">
                                                        <option value="">-- Seleccione --</option>
                                                        <option value="Distrito Nacional">Distrito Nacional</option>
                                                        <option value="Santo Domingo">Santo Domingo</option>
                                                        <option value="Santiago">Santiago</option>
                                                        <option value="La Vega">La Vega</option>
                                                        <option value="San Cristóbal">San Cristóbal</option>
                                                        <option value="Puerto Plata">Puerto Plata</option>
                                                        <option value="Duarte">Duarte</option>
                                                        <option value="La Romana">La Romana</option>
                                                        <!-- Agregar más provincias -->
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="ddlTipoPerfil" class="form-label">Tipo de Perfil</label>
                                                    <select class="form-control" id="ddlTipoPerfil" name="TipoPerfil">
                                                        <option value="1" selected>Persona Física</option>
                                                        <option value="2">Empresa</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="txtIdentificacion" class="form-label">RNC/Cédula</label>
                                                    <input type="text" class="form-control" id="txtIdentificacion" name="Identificacion" />
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sección Persona Física -->
                                        <div id="divTipoPersona" style="display:none;">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="txtNombre" class="form-label">Nombre</label>
                                                        <input type="text" class="form-control" id="txtNombre" name="Nombre" />
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="txtApellido" class="form-label">Apellido</label>
                                                        <input type="text" class="form-control" id="txtApellido" name="Apellido" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Sección Empresa -->
                                        <div id="divTipoEmpresa" style="display:none;">
                                            <div class="mb-3">
                                                <label for="txtRazonSocial" class="form-label">Razón Social</label>
                                                <input type="text" class="form-control" id="txtRazonSocial" name="RazonSocial" />
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="mb-3">
                                                    <label for="telefono1" class="form-label">Teléfono 1</label>
                                                    <input type="text" class="form-control" id="telefono1" name="Telefono1" />
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="chkWhatsapp1" class="form-label">WhatsApp?</label>
                                                    <div class="form-check">
                                                        <input type="checkbox" class="form-check-input" id="chkWhatsapp1" name="Whatsapp1" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="mb-3">
                                                    <label for="telefono2" class="form-label">Teléfono 2</label>
                                                    <input type="text" class="form-control" id="telefono2" name="Telefono2" />
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="chkWhatsapp2" class="form-label">WhatsApp?</label>
                                                    <div class="form-check">
                                                        <input type="checkbox" class="form-check-input" id="chkWhatsapp2" name="Whatsapp2" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-secondary">
                                <button type="submit" class="btn btn-primary" id="btnGuardar">
                                    <i class="fa fa-save"></i> Guardar Información
                                </button>
                                <button type="button" class="btn btn-danger" id="btnEstatus" style="display:none;">
                                    Desactivar Perfil
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Tab Catálogo de Servicios -->
                <div class="tab-pane fade" id="servicios">
                    <br />
                    <h5>Descripción de Servicio</h5>
                    <div class="row">
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="txtServicio" placeholder="Ingrese la descripción de servicio que ofrece" />
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-primary w-100" id="btnAgregar">
                                <i class="fa fa-plus"></i> Agregar
                            </button>
                        </div>
                    </div>

                    <div class="card-body mt-3">
                        <hr>
                        <h4 class="card-title">Servicios</h4>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered" id="gridServicios">
                                <thead>
                                    <tr>
                                        <th>Descripción</th>
                                        <th style="width: 100px;">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyServicios">
                                    <!-- Se cargarán desde la API -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function () {
            loadPerfil();
            loadServicios();

            // Preview de imagen
            $('#fileUpload').change(function () {
                showSelectedImage(this);
            });

            // Mostrar/ocultar secciones según tipo
            $('#ddlTipoPerfil').change(function () {
                if ($(this).val() === '2') {
                    $('#divTipoPersona').hide();
                    $('#divTipoEmpresa').show();
                } else {
                    $('#divTipoPersona').show();
                    $('#divTipoEmpresa').hide();
                }
            });
        });

        function loadPerfil() {
            // TODO: Cargar desde API
        }

        function loadServicios() {
            // TODO: Cargar desde API
        }

        function showSelectedImage(input) {
            var image = document.getElementById("profileImage");
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    image.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Guardar perfil
        $('#formPerfil').submit(function (e) {
            e.preventDefault();
            // TODO: Enviar a API
            MostrarAlerta();
        });

        // Agregar servicio
        $('#btnAgregar').click(function () {
            var servicio = $('#txtServicio').val().trim();
            if (servicio === '') {
                Swal.fire('Error', 'Ingrese una descripción del servicio', 'error');
                return;
            }

            // Agregar a la tabla
            var row = '<tr>' +
                '<td>' + servicio + '</td>' +
                '<td><button type="button" class="btn btn-sm btn-danger" onclick="removerServicio(this)"><i class="fa fa-trash"></i> Remover</button></td>' +
                '</tr>';
            $('#tbodyServicios').append(row);
            $('#txtServicio').val('');

            // TODO: Enviar a API
        });

        function removerServicio(btn) {
            Swal.fire({
                title: '¿Remover servicio?',
                text: 'Esta acción no se puede deshacer',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, remover',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    $(btn).closest('tr').remove();
                    // TODO: Enviar a API
                }
            });
        }

        // Desactivar perfil
        $('#btnEstatus').click(function () {
            Swal.fire({
                title: '¿Desactivar perfil?',
                text: 'Nadie podrá ver tu perfil publicado en el directorio',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, desactivar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    // TODO: Enviar a API
                    MostrarAlerta3();
                }
            });
        });

        function MostrarAlerta() {
            Swal.fire({
                title: 'Perfil Actualizado',
                text: 'Tu perfil ha sido actualizado correctamente.',
                icon: 'success',
                confirmButtonText: 'OK'
            });
        }

        function MostrarAlerta2() {
            Swal.fire({
                title: 'Perfil Activado',
                text: 'Todos los miembros de la comunidad podrán ver tu perfil en el directorio.',
                icon: 'success',
                confirmButtonText: 'OK'
            });
        }

        function MostrarAlerta3() {
            Swal.fire({
                title: 'Perfil Desactivado',
                text: 'Nadie podrá ver tu perfil publicado en el directorio.',
                icon: 'warning',
                confirmButtonText: 'OK'
            });
        }
    </script>
}
