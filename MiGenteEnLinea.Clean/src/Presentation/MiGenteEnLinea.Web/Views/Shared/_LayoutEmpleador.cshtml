@inject IOptions<ApiOptions> ApiOptions

@* Layout para dashboard de Empleadores
EXACTO al: FRONT_Publicado/Empleador/dashboard.Master
Tema: Argon Dashboard 2.0 *@
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>@ViewData["Title"] - Mi Gente en Linea</title>

    <!-- Google Fonts: Open Sans -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    
    <!-- Nucleo Icons -->
    <link href="~/lib/argon/css/nucleo-icons.css" rel="stylesheet" />
    <link href="~/lib/argon/css/nucleo-svg.css" rel="stylesheet" />
    
    <!-- Font Awesome 5.15.4 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
    
    <!-- Argon Dashboard CSS -->
    <link href="~/lib/argon/css/argon-dashboard.min.css" rel="stylesheet" />
    
    <!-- Custom Styles -->
    <link href="~/css/animated.css" rel="stylesheet" />
    <link href="~/css/Custom.css" rel="stylesheet" />
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @@font-face {
            font-family: "Gurajada";
            src: url(/fonts/Gurajada-Regular.ttf);
        }
        .headerText {
            font-family: "Gurajada", Gurajada;
        }
        .checked {
            color: orange;
        }
        .divCalificacionCard {
            text-align: end;
            margin-top: 15px;
        }
        .pricing-content {
            position: relative;
        }
        .pricing_design {
            position: relative;
            margin: 0px 15px;
        }
        .pricing_design .single-pricing {
            background: #00176B;
            padding: 60px 40px;
            border-radius: 30px;
            box-shadow: 0 10px 40px -10px rgba(0,64,128,.2);
            position: relative;
            z-index: 1;
        }
        .pricing_design .single-pricing:before {
            content: "";
            background-color: #fff;
            width: 100%;
            height: 100%;
            border-radius: 18px 18px 190px 18px;
            border: 1px solid #eee;
            position: absolute;
            bottom: 0;
            right: 0;
            z-index: -1;
        }
        .price-head h2 {
            margin-bottom: 20px;
            font-size: 26px;
            font-weight: 600;
        }
        .price-head h1 {
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 5px;
        }
        .single-pricing ul {
            list-style: none;
            margin-top: 30px;
        }
        .single-pricing ul li {
            line-height: 36px;
        }
        .single-pricing ul li i {
            background: #554c86;
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 30px;
            font-size: 11px;
            text-align: center;
            line-height: 20px;
            margin-right: 6px;
        }
        .price_btn {
            background: #00176B;
            padding: 10px 30px;
            color: #fff;
            display: inline-block;
            margin-top: 20px;
            border-radius: 2px;
            -webkit-transition: 0.3s;
            transition: 0.3s;
        }
        .price_btn:hover {
            background: #0aa1d6;
        }
        .banner {
            position: relative;
            height: 500px;
            background: url("/images/bannerADM1.jpg");
            background-size: cover;
            background-position: unset;
        }
    </style>
    
    @await RenderSectionAsync("Styles", required: false)
</head>
<body class="g-sidenav-show bg-gray-100">
    <!-- Banner superior con gradiente -->
    <div class="min-height-300 banner position-absolute w-100"></div>
    
    <!-- Sidebar / Sidenav -->
    <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4" id="sidenav-main">
        <div class="sidenav-header" style="text-align: center; margin-top: 10px;">
            <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
            <a class="justify-content-center" asp-controller="Empleador" asp-action="Dashboard">
                <img src="~/images/logoMiGene.png" width="120" alt="main_logo" />
            </a>
        </div>
        <hr class="horizontal dark mt-0" />
        <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
            <ul class="navbar-nav justify-content-end">
                <!-- Menu Principal -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")" asp-controller="Empleador" asp-action="Index">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Menu Principal</span>
                    </a>
                </li>
                <!-- Gestor de Colaboradores -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Empleados" ? "active" : "")" href="#" data-bs-toggle="modal" data-bs-target="#modalGestorColaboradores">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-calendar-grid-58 text-warning text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Gestor de Colaboradores</span>
                    </a>
                </li>
                <!-- Calificacion de Perfiles -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Calificaciones" ? "active" : "")" asp-controller="Empleador" asp-action="Calificaciones">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-credit-card text-success text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Calificación de Perfiles</span>
                    </a>
                </li>
                <!-- Directorio -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Buscador" ? "active" : "")" asp-controller="Empleador" asp-action="Buscador">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-like-2 text-success text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Directorio</span>
                    </a>
                </li>
                
                <!-- Separator: Gestion de Cuenta -->
                <li class="nav-item mt-3">
                    <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Gestion de Cuenta</h6>
                </li>
                <!-- Perfil -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "Perfil" ? "active" : "")" asp-controller="Empleador" asp-action="Perfil">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-single-02 text-dark text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Perfil</span>
                    </a>
                </li>
                <!-- Suscripcion -->
                <li class="nav-item">
                    <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "MiSuscripcion" ? "active" : "")" asp-controller="Empleador" asp-action="MiSuscripcion">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-single-copy-04 text-warning text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Suscripcion</span>
                    </a>
                </li>
                <!-- Cerrar Sesion -->
                <li class="nav-item">
                    <a class="nav-link" asp-controller="Auth" asp-action="Logout">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-collection text-info text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Cerrar Sesión</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content position-relative border-radius-lg">
        <!-- Navbar superior -->
        <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="false">
            <div class="container-fluid py-1 px-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                        <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="javascript:;">Empleador</a></li>
                        <li class="breadcrumb-item text-sm text-white active" aria-current="page">@ViewData["Title"]</li>
                    </ol>
                </nav>
                <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                    <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                    </div>
                    <ul class="navbar-nav justify-content-end">
                        <li class="nav-item d-flex align-items-center">
                            <a href="javascript:;" class="nav-link text-white font-weight-bold px-0">
                                <i class="fa fa-user me-sm-1"></i>
                                <span class="d-sm-inline d-none">@User.Identity?.Name</span>
                            </a>
                        </li>
                        <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
                            <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                                <div class="sidenav-toggler-inner">
                                    <i class="sidenav-toggler-line bg-white"></i>
                                    <i class="sidenav-toggler-line bg-white"></i>
                                    <i class="sidenav-toggler-line bg-white"></i>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- End Navbar -->
        
        <!-- Page Content -->
        <div class="container-fluid py-4">
            @RenderBody()
        </div>
    </main>
    
    <!-- Modal: Tipo de Gestion -->
    <div class="modal fade" id="modalGestorColaboradores" tabindex="-1" aria-labelledby="modalGestorColaboradoresLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h5 class="modal-title" id="modalGestorColaboradoresLabel">Tipo de Gestion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <a asp-controller="Empleador" asp-action="Empleados" class="btn btn-primary btn-lg mb-3">Colaboradores Fijos</a>
                    <a asp-controller="Empleador" asp-action="Contrataciones" class="btn btn-secondary btn-lg">Contrataciones Temporales</a>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Scripts de Argon Dashboard -->
    <script src="~/lib/argon/js/core/popper.min.js"></script>
    <script src="~/lib/argon/js/core/bootstrap.min.js"></script>
    <script src="~/lib/argon/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="~/lib/argon/js/plugins/smooth-scrollbar.min.js"></script>
    <script src="~/lib/argon/js/argon-dashboard.min.js"></script>
    
    <!-- API Configuration (injected from server) -->
    <script>
      window.API_BASE = '@ApiOptions.Value.BaseUrl';
      window.API_TIMEOUT = @ApiOptions.Value.TimeoutSeconds * 1000;
    </script>
    
    <!-- Custom JS -->
    <script src="~/js/custom.js"></script>
    
    <!-- Initialize scrollbar for sidenav -->
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = { damping: '0.5' }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>
    
    <!-- Validación de Plan Activo -->
    <script>
        (function() {
            // Verificar si estamos en la página de AdquirirPlan (no bloquear esa página)
            const currentPath = window.location.pathname.toLowerCase();
            const isAdquirirPlan = currentPath.includes('adquirirplan');
            const isMiSuscripcion = currentPath.includes('misuscripcion');
            
            // Páginas permitidas sin plan activo
            if (isAdquirirPlan || isMiSuscripcion) {
                return; // No bloquear estas páginas
            }
            
            // Verificar si el usuario tiene un plan activo
            const planId = localStorage.getItem('planId');
            const vencimientoPlan = localStorage.getItem('vencimientoPlan');
            const accessToken = localStorage.getItem('accessToken');
            
            // Si no hay token, redirigir a login
            if (!accessToken) {
                window.location.href = '/Auth/Login';
                return;
            }
            
            // Verificar si tiene plan válido
            let tienePlanActivo = false;
            
            if (planId && planId !== '0' && planId !== 'null' && planId !== '') {
                // Verificar si no ha vencido
                if (vencimientoPlan && vencimientoPlan !== '' && vencimientoPlan !== 'null') {
                    const fechaVencimiento = new Date(vencimientoPlan);
                    const hoy = new Date();
                    tienePlanActivo = fechaVencimiento > hoy;
                } else {
                    // Tiene planId pero no fecha de vencimiento, asumir activo
                    tienePlanActivo = true;
                }
            }
            
            // Si no tiene plan activo, redirigir a AdquirirPlan
            if (!tienePlanActivo) {
                console.log('Usuario sin plan activo. Redirigiendo a AdquirirPlan...');
                Swal.fire({
                    title: 'Plan Requerido',
                    text: 'Para acceder a las funciones de la plataforma, primero debe adquirir un plan.',
                    icon: 'warning',
                    confirmButtonText: 'Ver Planes',
                    confirmButtonColor: '#00176B',
                    allowOutsideClick: false,
                    allowEscapeKey: false
                }).then(() => {
                    window.location.href = '/Empleador/AdquirirPlan';
                });
            }
        })();
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
